name: relayserver-demo-group
apiVersion: '2021-10-01'
location: '%location%'
properties:
  containers:
  - name: rabbitmq
    properties:
      image: rabbitmq:3-management
      environmentVariables:
      - name: RABBITMQ_DEFAULT_USER
        value: 'relayserver'
      - name: RABBITMQ_DEFAULT_PASS
        value: '<Strong!Passw0rd>'
      ports:
      - port: 5672
      resources:
        requests:
          cpu: 2.0
          memoryInGb: 1.0
  - name: relayserver
    properties:
      image: '%acrName%.azurecr.io/relayserver:v1'
      environmentVariables:
      - name: ASPNETCORE_URLS
        value: 'http://*:80;https://*:443'
      - name: RabbitMq__Uri
        value: 'amqp://relayserver:<Strong!Passw0rd>@localhost'
      - name: Authentication__Authority
        value: 'https://%dnsNameLabel%.westeurope.azurecontainer.io'
      - name: LettuceEncrypt__DomainNames__0
        value: '%dnsNameLabel%.westeurope.azurecontainer.io'
      - name: LettuceEncrypt__EmailAddress
        value: '%email%'
      ports:
      - port: 80
      - port: 443
      resources:
        requests:
          cpu: 2.0
          memoryInGb: 2.0
      readinessProbe:
        httpGet:
          path: /_ready
          port: 80
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
      livenessProbe:
        httpGet:
          path: /_healthy
          port: 80
        initialDelaySeconds: 60
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
  osType: Linux
  restartPolicy: OnFailure
  ipAddress:
    ports:
    - protocol: tcp
      port: '80'
    - protocol: tcp
      port: '443'
    type: Public
    dnsNameLabel: '%dnsNameLabel%'
tags: null
type: Microsoft.ContainerInstance/containerGroups
